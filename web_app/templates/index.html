<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Tumor Detector - Medical AI</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* 1. Font Setting */
        body { font-family: 'Inter', sans-serif; }

        /* 2. Sembunyikan Scrollbar (Clean Look) */
        html, body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        html::-webkit-scrollbar, body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* 3. Smooth Scroll */
        html { scroll-behavior: smooth; }
        
        /* 4. Glassmorphism Effect */
        .glass {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        /* 5. Card Hover Animation */
        .hover-card { transition: all 0.3s ease; }
        .hover-card:hover { transform: translateY(-5px); }

        /* 6. Text Gradient Animation */
        .animate-gradient {
            background-size: 200%;
            -webkit-background-clip: text;
            background-clip: text;
            animation: gradient-move 3s ease infinite;
        }

        /* 7. Background Gradient Animation (Button) */
        .animate-gradient-bg {
            background-size: 200%;
            animation: gradient-move 3s ease infinite;
        }

        /* Keyframes untuk Gradient */
        @keyframes gradient-move {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* 8. Shine Effect Animation */
        @keyframes shine {
            100% { left: 125%; }
        }
        
        .animate-shine {
            animation: shine 1s;
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 flex flex-col min-h-screen relative overflow-x-hidden">

    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[128px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-600/10 rounded-full blur-[128px]"></div>
        <div class="absolute top-[20%] right-[20%] w-[300px] h-[300px] bg-pink-600/10 rounded-full blur-[100px]"></div>
    </div>

    <header class="fixed top-0 w-full z-50 glass border-b border-gray-800/50 transition-all duration-300">
        <div class="w-full px-6 md:px-12 h-20 flex items-center justify-between relative">
            
            <a href="#" onclick="event.preventDefault(); window.scrollTo({ top: 0, behavior: 'smooth' });" 
               class="flex items-center gap-4 select-none cursor-pointer">
                
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <i class="fa-solid fa-brain text-white text-lg"></i>
                </div>
                
                <div class="hidden sm:block">
                    <h1 class="font-bold text-lg tracking-tight text-white leading-tight">Brain Tumor Detector</h1>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest font-semibold">U-Net Segmentation AI</p>
                </div>
            </a>

            <nav class="hidden md:flex items-center gap-8 absolute left-1/2 transform -translate-x-1/2 h-full">
                
                <a href="#about" class="nav-link relative group h-full flex items-center px-2 text-sm font-medium text-gray-300 hover:text-white transition-colors duration-300">
                    Tentang
                    <span class="nav-line absolute bottom-0 left-0 w-0 h-[3px] bg-blue-500 rounded-t-full transition-all duration-300 ease-out group-hover:w-full shadow-[0_-2px_10px_rgba(59,130,246,0.8)]"></span>
                </a>

                <a href="#technology" class="nav-link relative group h-full flex items-center px-2 text-sm font-medium text-gray-300 hover:text-white transition-colors duration-300">
                    Teknologi
                    <span class="nav-line absolute bottom-0 left-0 w-0 h-[3px] bg-blue-500 rounded-t-full transition-all duration-300 ease-out group-hover:w-full shadow-[0_-2px_10px_rgba(59,130,246,0.8)]"></span>
                </a>

                <a href="#detect" class="nav-link relative group h-full flex items-center px-2 text-sm font-medium text-gray-300 hover:text-white transition-colors duration-300">
                    Deteksi
                    <span class="nav-line absolute bottom-0 left-0 w-0 h-[3px] bg-blue-500 rounded-t-full transition-all duration-300 ease-out group-hover:w-full shadow-[0_-2px_10px_rgba(59,130,246,0.8)]"></span>
                </a>

            </nav>

            <div class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-300">
                <span class="px-4 py-1.5 bg-gray-800/80 rounded-full border border-gray-700 text-xs flex items-center gap-2 shadow-sm">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    System Online v1.0
                </span>
            </div>

        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 pt-32 pb-20 flex flex-col items-center">

        <div class="text-center max-w-5xl mx-auto mb-20 relative z-10">
            
            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gray-900/40 border border-blue-500/30 backdrop-blur-md mb-8 hover:border-blue-400/50 transition-all duration-300 cursor-default group shadow-lg shadow-blue-500/10">
                <span class="text-xs font-bold text-blue-200 tracking-widest uppercase group-hover:text-blue-400 transition-colors">
                    Powered by TensorFlow & U-Net
                </span>
            </div>
            
            <h2 class="text-5xl md:text-7xl font-extrabold mb-8 tracking-tight leading-[1.1]">
                <span class="block text-white drop-shadow-md mb-2">
                    Segmentasi Tumor Otak
                </span>
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 animate-gradient drop-shadow-2xl">
                    Berbasis Kecerdasan Buatan
                </span>
            </h2>
            
            <p class="text-gray-400 text-lg md:text-xl leading-relaxed max-w-3xl mx-auto font-light">
                Platform medis modern untuk mendeteksi dan memetakan area tumor dari citra MRI secara otomatis dengan presisi tinggi dalam hitungan detik.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-7xl mb-16 px-4">
            
            <div class="glass p-8 rounded-3xl hover-card group border border-emerald-500/30 relative overflow-hidden bg-gray-900/40">
                <div class="absolute top-0 right-0 p-4 opacity-50">
                    <i class="fa-solid fa-chart-line text-emerald-500 text-6xl opacity-10 transform rotate-12 group-hover:scale-110 transition"></i>
                </div>
                
                <div class="flex items-end gap-2 mb-4">
                    <span class="text-5xl font-extrabold text-white tracking-tighter">98.2</span>
                    <span class="text-xl font-bold text-emerald-400 mb-2">%</span>
                </div>
                
                <h3 class="text-lg font-bold text-gray-200 mb-1">Validation Accuracy</h3>
                <p class="text-gray-400 text-xs leading-relaxed">
                    Tingkat ketepatan model dalam mengklasifikasikan piksel tumor vs non-tumor pada dataset pengujian.
                </p>
                
                <div class="w-full bg-gray-700 h-1.5 rounded-full mt-4 overflow-hidden">
                    <div class="bg-emerald-500 h-full rounded-full" style="width: 98.2%"></div>
                </div>
            </div>

            <div class="glass p-8 rounded-3xl hover-card group border border-amber-500/30 relative overflow-hidden bg-gray-900/40">
                <div class="absolute top-0 right-0 p-4 opacity-50">
                    <i class="fa-solid fa-stopwatch text-amber-500 text-6xl opacity-10 transform -rotate-12 group-hover:scale-110 transition"></i>
                </div>
                
                <div class="flex items-end gap-2 mb-4">
                    <span class="text-5xl font-extrabold text-white tracking-tighter">< 0.5</span>
                    <span class="text-xl font-bold text-amber-400 mb-2">s</span>
                </div>
                
                <h3 class="text-lg font-bold text-gray-200 mb-1">Inference Speed</h3>
                <p class="text-gray-400 text-xs leading-relaxed">
                    Waktu rata-rata yang dibutuhkan server untuk memproses satu citra MRI resolusi 256x256 piksel.
                </p>
                
                 <div class="w-full bg-gray-700 h-1.5 rounded-full mt-4 overflow-hidden">
                    <div class="bg-amber-500 h-full rounded-full" style="width: 95%"></div>
                </div>
            </div>

            <div class="glass p-8 rounded-3xl hover-card group border border-cyan-500/30 relative overflow-hidden bg-gray-900/40">
                <div class="absolute top-0 right-0 p-4 opacity-50">
                    <i class="fa-solid fa-shapes text-cyan-500 text-6xl opacity-10 transform rotate-45 group-hover:scale-110 transition"></i>
                </div>
                
                <div class="flex items-end gap-2 mb-4">
                    <span class="text-5xl font-extrabold text-white tracking-tighter">0.89</span>
                    <span class="text-xl font-bold text-cyan-400 mb-2">IoU</span>
                </div>
                
                <h3 class="text-lg font-bold text-gray-200 mb-1">Mean IoU Score</h3>
                <p class="text-gray-400 text-xs leading-relaxed">
                    Intersection over Union: Standar emas untuk mengukur seberapa presisi bentuk segmentasi AI dibanding aslinya.
                </p>
                
                 <div class="w-full bg-gray-700 h-1.5 rounded-full mt-4 overflow-hidden">
                    <div class="bg-cyan-500 h-full rounded-full" style="width: 89%"></div>
                </div>
            </div>

        </div>

        <section class="w-full max-w-7xl mt-32 mb-20 relative">
            
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[400px] bg-blue-900/10 rounded-full blur-[100px] -z-10 pointer-events-none"></div>

            <div id="about" class="text-center mb-16 px-4 scroll-mt-32">
                <span class="text-blue-500 font-bold tracking-widest text-xs uppercase mb-2 block animate-pulse">Latar Belakang</span>
                <h2 class="text-3xl md:text-5xl font-extrabold text-white mb-6">
                    Mengapa Brain Tumor Detector?</span>
                </h2>
                <p class="text-gray-400 max-w-3xl mx-auto text-lg leading-relaxed">
                    Diagnosa manual citra MRI memakan waktu dan rentan terhadap kesalahan manusia (*human error*). 
                    Kami menghadirkan solusi berbasis AI untuk menjadi "mata kedua" bagi tenaga medis, memberikan 
                    analisis awal yang cepat, presisi, dan konsisten.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 px-4">
                <div class="group relative bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-3xl p-8 hover:border-blue-500/50 transition-all duration-500 hover:-translate-y-2 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-600/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="w-14 h-14 bg-gray-800 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-blue-600 transition-colors duration-500 shadow-lg group-hover:shadow-blue-500/40 relative z-10">
                        <i class="fa-solid fa-network-wired text-2xl text-blue-400 group-hover:text-white transition-colors duration-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3 group-hover:text-blue-400 transition-colors">Arsitektur U-Net</h3>
                    <p class="text-sm text-gray-400 leading-relaxed group-hover:text-gray-300 transition-colors">
                        Menggunakan Deep Learning U-Net yang dirancang khusus untuk segmentasi biomedis dengan presisi tingkat piksel.
                    </p>
                </div>

                <div class="group relative bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-3xl p-8 hover:border-purple-500/50 transition-all duration-500 hover:-translate-y-2 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-600/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="w-14 h-14 bg-gray-800 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-purple-600 transition-colors duration-500 shadow-lg group-hover:shadow-purple-500/40 relative z-10">
                        <i class="fa-solid fa-bolt text-2xl text-purple-400 group-hover:text-white transition-colors duration-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3 group-hover:text-purple-400 transition-colors">Efisiensi Waktu</h3>
                    <p class="text-sm text-gray-400 leading-relaxed group-hover:text-gray-300 transition-colors">
                        Memangkas waktu analisis dari puluhan menit menjadi hitungan detik, memungkinkan penanganan pasien lebih cepat.
                    </p>
                </div>

                <div class="group relative bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-3xl p-8 hover:border-pink-500/50 transition-all duration-500 hover:-translate-y-2 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-600/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="w-14 h-14 bg-gray-800 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-pink-600 transition-colors duration-500 shadow-lg group-hover:shadow-pink-500/40 relative z-10">
                        <i class="fa-solid fa-layer-group text-2xl text-pink-400 group-hover:text-white transition-colors duration-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3 group-hover:text-pink-400 transition-colors">Visualisasi Overlay</h3>
                    <p class="text-sm text-gray-400 leading-relaxed group-hover:text-gray-300 transition-colors">
                        Menampilkan peta lokasi tumor secara transparan di atas citra asli untuk memudahkan verifikasi dokter.
                    </p>
                </div>

                <div class="group relative bg-gray-900/50 backdrop-blur-md border border-gray-800 rounded-3xl p-8 hover:border-emerald-500/50 transition-all duration-500 hover:-translate-y-2 overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-emerald-600/10 to-transparent opacity-0 group-hover:opacity-100 transition duration-500"></div>
                    <div class="w-14 h-14 bg-gray-800 rounded-2xl flex items-center justify-center mb-6 group-hover:bg-emerald-600 transition-colors duration-500 shadow-lg group-hover:shadow-emerald-500/40 relative z-10">
                        <i class="fa-solid fa-globe text-2xl text-emerald-400 group-hover:text-white transition-colors duration-300"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-3 group-hover:text-emerald-400 transition-colors">Akses Fleksibel</h3>
                    <p class="text-sm text-gray-400 leading-relaxed group-hover:text-gray-300 transition-colors">
                        Berbasis web modern yang dapat diakses dari perangkat apapun tanpa instalasi software berat.
                    </p>
                </div>
            </div>
        </section>

        <section id="technology" class="w-full max-w-7xl mt-32 mb-32 px-4 scroll-mt-32 relative">
            
            <div class="absolute left-1/2 -translate-x-1/2 top-0 h-full w-px bg-gradient-to-b from-transparent via-blue-500/20 to-transparent -z-10 hidden md:block"></div>

            <div class="text-center mb-16">
                <span class="text-purple-500 font-bold tracking-widest text-xs uppercase mb-2 block animate-pulse">System Core</span>
                <h2 class="text-3xl md:text-5xl font-extrabold text-white">
                    Arsitektur & Teknologi</span>
                </h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                <div class="group flex items-start gap-6 bg-gray-900/40 border border-gray-800 p-6 rounded-2xl hover:border-orange-500/50 transition-all duration-300 hover:bg-gray-900/80 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-125">
                        <i class="fa-solid fa-microchip text-8xl text-orange-500"></i>
                    </div>
                    
                    <div class="w-16 h-16 bg-orange-500/10 rounded-xl flex items-center justify-center border border-orange-500/20 group-hover:bg-orange-500 group-hover:text-white transition-colors duration-300 flex-shrink-0">
                        <i class="fa-solid fa-microchip text-3xl text-orange-500 group-hover:text-white"></i>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-bold text-white mb-2">TensorFlow & Keras</h3>
                        <p class="text-sm text-gray-400 leading-relaxed mb-3">
                            Digunakan sebagai framework utama untuk melatih dan menjalankan model segmentasi berbasis convolutional neural network (CNN) pada citra MRI.
                        </p>
                        <span class="inline-block px-2 py-1 bg-orange-500/10 border border-orange-500/20 rounded text-[10px] text-orange-400 font-mono">Deep Learning</span>
                    </div>
                </div>

                <div class="group flex items-start gap-6 bg-gray-900/40 border border-gray-800 p-6 rounded-2xl hover:border-blue-500/50 transition-all duration-300 hover:bg-gray-900/80 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-125">
                        <i class="fa-solid fa-diagram-project text-8xl text-blue-500"></i>
                    </div>

                    <div class="w-16 h-16 bg-blue-500/10 rounded-xl flex items-center justify-center border border-blue-500/20 group-hover:bg-blue-500 group-hover:text-white transition-colors duration-300 flex-shrink-0">
                        <i class="fa-solid fa-brain text-3xl text-blue-500 group-hover:text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white mb-2">U-Net Architecture</h3>
                        <p class="text-sm text-gray-400 leading-relaxed mb-3">
                            Arsitektur CNN berbentuk “U” yang banyak digunakan dalam segmentasi citra biomedis karena kemampuannya mempertahankan informasi spasial melalui mekanisme skip connection.
                        </p>
                        <span class="inline-block px-2 py-1 bg-blue-500/10 border border-blue-500/20 rounded text-[10px] text-blue-400 font-mono">Segmentation Model</span>
                    </div>
                </div>

                <div class="group flex items-start gap-6 bg-gray-900/40 border border-gray-800 p-6 rounded-2xl hover:border-yellow-500/50 transition-all duration-300 hover:bg-gray-900/80 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-125">
                        <i class="fa-brands fa-python text-8xl text-yellow-500"></i>
                    </div>

                    <div class="w-16 h-16 bg-yellow-500/10 rounded-xl flex items-center justify-center border border-yellow-500/20 group-hover:bg-yellow-500 group-hover:text-black transition-colors duration-300 flex-shrink-0">
                        <i class="fa-brands fa-python text-3xl text-yellow-500 group-hover:text-black"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white mb-2">Python & Flask</h3>
                        <p class="text-sm text-gray-400 leading-relaxed mb-3">
                            Digunakan sebagai backend server untuk mengelola inferensi model dan komunikasi antara sistem kecerdasan buatan dan antarmuka web.
                        </p>
                        <span class="inline-block px-2 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded text-[10px] text-yellow-400 font-mono">Backend Integration</span>
                    </div>
                </div>

                <div class="group flex items-start gap-6 bg-gray-900/40 border border-gray-800 p-6 rounded-2xl hover:border-green-500/50 transition-all duration-300 hover:bg-gray-900/80 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition transform group-hover:scale-125">
                        <i class="fa-solid fa-eye text-8xl text-green-500"></i>
                    </div>

                    <div class="w-16 h-16 bg-green-500/10 rounded-xl flex items-center justify-center border border-green-500/20 group-hover:bg-green-500 group-hover:text-white transition-colors duration-300 flex-shrink-0">
                        <i class="fa-solid fa-eye text-3xl text-green-500 group-hover:text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-white mb-2">OpenCV Library</h3>
                        <p class="text-sm text-gray-400 leading-relaxed mb-3">
                            Digunakan untuk pra-pemrosesan citra MRI serta visualisasi hasil segmentasi dalam bentuk overlay dan kontur.
                        </p>
                        <span class="inline-block px-2 py-1 bg-green-500/10 border border-green-500/20 rounded text-[10px] text-green-400 font-mono">Image Processing</span>
                    </div>
                </div>

            </div>
        </section>

        {% if error %}
        <div class="w-full max-w-7xl mb-8 animate-fade-in-up">
            <div class="bg-red-500/10 border border-red-500/50 rounded-xl p-4 flex items-center gap-4 text-red-200 shadow-lg shadow-red-900/20">
                <div class="w-10 h-10 bg-red-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                    <i class="fa-solid fa-triangle-exclamation text-red-500"></i>
                </div>
                <div>
                    <h4 class="font-bold text-red-400 text-sm">Gagal Memproses Permintaan</h4>
                    <p class="text-xs opacity-80 mt-1">{{ error }}</p>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-red-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
        </div>
        {% endif %}

        <section id="detect" class="w-full max-w-7xl mb-10 mt-32 scroll-mt-32 px-4 relative">
            
            <div class="text-center mb-12">
                <span class="text-pink-500 font-bold tracking-widest text-xs uppercase mb-3 block animate-pulse">
                    AI Detection System
                </span>
                
                <h2 class="text-3xl md:text-5xl font-extrabold text-white mb-4">
                    Mulai Analisis Citra MRI
                </h2>
                
                <p class="text-gray-400 max-w-4xl mx-auto text-lg leading-relaxed">
                    Upload citra MRI untuk pemindaian otomatis dan identifikasi area tumor dalam hitungan detik.
                </p>
            </div>

            <div class="w-full max-w-7xl mx-auto rounded-[31px] shadow-2xl p-[1px] relative group transform transition duration-500 hover:scale-[1.01] z-0">
                
                <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 blur-lg opacity-0 group-hover:opacity-40 transition duration-500 -z-10"></div>

                <div class="absolute inset-0 bg-gradient-to-r from-blue-500/50 via-purple-500/50 to-pink-500/50 opacity-50 group-hover:opacity-100 transition duration-500 rounded-[32px] z-0"></div>
                
                <div class="bg-gray-950 relative rounded-[31px] h-full overflow-hidden z-10">
                    
                    <div id="loading-bar" class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 hidden animate-pulse z-50"></div>

                    <div class="absolute inset-0 bg-gray-900/20 backdrop-blur-sm"></div>

                    <div class="relative p-8 md:p-12 z-10">
                        <form action="/" method="post" enctype="multipart/form-data" id="upload-form">
                            
                            <label for="file-upload" id="drop-zone" 
                                   class="relative flex flex-col items-center justify-center w-full h-96 border-2 border-gray-700 border-dashed rounded-3xl cursor-pointer hover:border-blue-500 hover:bg-gray-900/50 transition-all duration-300 group/zone bg-gray-900/20 overflow-hidden">
                                
                                <div class="absolute inset-0 opacity-10 pointer-events-none" 
                                     style="background-image: radial-gradient(#4f46e5 1px, transparent 1px); background-size: 24px 24px;">
                                </div>
                                <div class="absolute inset-0 bg-blue-500/5 blur-[100px] opacity-0 group-hover/zone:opacity-100 transition duration-500"></div>
                                
                                <div class="flex flex-col items-center justify-center pt-5 pb-6 text-center px-4 z-10 transition-opacity duration-300" id="preview-container">
                                    <div class="w-28 h-28 mb-6 bg-gray-800 rounded-full flex items-center justify-center group-hover/zone:scale-110 group-hover/zone:bg-blue-900/30 transition-all duration-300 shadow-2xl shadow-blue-900/20 border border-gray-700 group-hover/zone:border-blue-500/50">
                                        <i class="fa-solid fa-cloud-arrow-up text-5xl text-blue-500 group-hover/zone:text-blue-400 transition-colors"></i>
                                    </div>
                                    <p class="mb-3 text-2xl text-gray-200 font-bold group-hover/zone:text-white transition-colors">Drag & Drop file MRI</p>
                                    <p class="text-base text-gray-500 group-hover/zone:text-blue-300/80">atau <span class="text-blue-400 underline decoration-blue-500/30 underline-offset-4">klik untuk menjelajah</span> folder komputer</p>
                                    <div class="mt-4 flex gap-2">
                                        <span class="px-2 py-1 rounded bg-gray-800 border border-gray-700 text-[10px] text-gray-400 font-mono">JPG</span>
                                        <span class="px-2 py-1 rounded bg-gray-800 border border-gray-700 text-[10px] text-gray-400 font-mono">PNG</span>
                                        <span class="px-2 py-1 rounded bg-gray-800 border border-gray-700 text-[10px] text-gray-400 font-mono">TIF</span>
                                    </div>
                                </div>
                                
                                <img id="image-preview" class="hidden absolute inset-0 w-full h-full object-contain p-8 bg-gray-950 rounded-3xl z-20" />
                                <input id="file-upload" name="file" type="file" class="hidden" accept=".jpg,.jpeg,.png,.tif,.tiff" />
                            </label>

                            <div id="file-name" class="text-center mt-6 h-6 text-base text-blue-400 font-medium hidden animate-pulse"></div>

                            <button type="submit" onclick="validateAndAnalyze(event)"
                                    class="mt-10 w-full bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 animate-gradient-bg text-white font-extrabold py-5 px-8 rounded-2xl shadow-xl shadow-purple-900/20 transform transition hover:-translate-y-1 active:translate-y-0 text-xl flex justify-center items-center gap-3 group/btn relative overflow-hidden">
                                <div class="absolute top-0 -inset-full h-full w-1/2 z-5 block transform -skew-x-12 bg-gradient-to-r from-transparent to-white opacity-20 group-hover/btn:animate-shine"></div>
                                <span>Mulai Analisis</span> 
                                <i class="fa-solid fa-microscope group-hover/btn:rotate-12 transition-transform"></i>
                            </button>

                        </form>
                    </div>
                </div>
            </div>
        </section>

       <div id="result-section" class="hidden w-full max-w-7xl mt-8 animate-fade-in-up scroll-mt-24 transition-all duration-500">
            
            <div class="flex items-center gap-6 mb-10">
                <div class="h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent flex-grow"></div>
                <h3 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-gray-100 to-gray-400">Hasil Analisis</h3>
                <div class="h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent flex-grow"></div>
            </div>

            <div class="glass rounded-[32px] p-2 border border-gray-700/50 shadow-2xl bg-gray-900/40 backdrop-blur-xl relative overflow-hidden">
                
                <div class="absolute top-0 right-0 w-96 h-96 bg-blue-500/10 rounded-full blur-[100px] -z-10"></div>

                <div class="bg-gray-950/50 rounded-[28px] p-6 md:p-10 transition-all duration-500 ease-in-out">
                    
                    <div class="flex flex-col md:flex-row gap-8">
                        
                        <div class="w-full md:w-5/12 relative group cursor-pointer">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl blur opacity-30 group-hover:opacity-60 transition duration-500"></div>
                            <div class="relative rounded-2xl overflow-hidden h-72 md:h-80 border border-gray-700 bg-black shadow-2xl">
                                <img id="display-res-hero" src="" class="w-full h-full object-contain transform transition duration-700 group-hover:scale-105">
                            </div>
                        </div>

                        <div class="w-full md:w-7/12 flex flex-col justify-center">
                            
                            <div class="mb-6">
                                <p class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2">Kesimpulan Diagnosa</p>
                                <div class="flex items-center gap-6">
                                    <h2 id="display-prediction" class="text-5xl md:text-6xl font-extrabold text-white drop-shadow-lg tracking-tight leading-none">
                                        Loading...
                                    </h2>
                                    <div id="icon-container"></div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                                <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50">
                                    <p class="text-gray-400 text-[10px] uppercase font-bold mb-1">Status</p>
                                    <p id="display-status-label" class="text-xl font-bold text-gray-300">...</p>
                                </div>
                                <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50">
                                    <p class="text-gray-400 text-[10px] uppercase font-bold mb-1">Jumlah Titik</p>
                                    <p class="text-xl font-bold text-blue-400">
                                        <span id="display-count">0</span> <span class="text-sm text-gray-500">Spot</span>
                                    </p>
                                </div>
                                <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50 col-span-2 md:col-span-1">
                                    <p class="text-gray-400 text-[10px] uppercase font-bold mb-1">Total Luas</p>
                                    <p class="text-xl font-bold text-yellow-400 font-mono">
                                        <span id="display-area">0</span> <span class="text-sm text-gray-500">cm²</span>
                                    </p>
                                </div>
                            </div>

                            <div class="flex flex-col sm:flex-row gap-4">
                                <button onclick="toggleDetails()" id="btn-detail" 
                                        class="flex-1 bg-gray-800 hover:bg-gray-700 text-white font-bold py-4 px-6 rounded-xl border border-gray-600 transition-all duration-300 flex items-center justify-center gap-2 group">
                                    <i class="fa-solid fa-list-check group-hover:text-blue-400 transition-colors"></i>
                                    <span>Lihat Detail Layer</span>
                                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300" id="chevron-icon"></i>
                                </button>
                                
                                <button onclick="resetApp()" 
                                        class="group flex-1 bg-transparent hover:bg-gray-800 text-gray-400 hover:text-white font-bold py-4 px-6 rounded-xl border border-gray-700 transition-all duration-300 flex items-center justify-center gap-2">
                                    <i class="fa-solid fa-rotate transition-transform duration-500 ease-in-out group-hover:-rotate-180"></i> 
                                    Reset
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="detailed-results" class="hidden transition-all duration-700 ease-in-out overflow-hidden opacity-0 transform translate-y-4">
                        
                        <div class="relative flex items-center justify-center py-12">
                            <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                <div class="w-full h-px bg-gradient-to-r from-transparent via-blue-600/50 to-transparent"></div>
                            </div>
                            <div class="relative z-10 flex items-center gap-3 bg-gray-900 border border-blue-500/30 px-6 py-2 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.2)]">
                                <span class="text-[10px] font-bold text-blue-100 tracking-[0.2em] uppercase font-mono">
                                    Visualisasi Layer U-Net
                                </span>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-20">
                            <div class="group bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden hover:border-gray-600 transition duration-500 shadow-lg">
                                <div class="bg-gray-800/30 px-6 py-3 border-b border-gray-800 flex justify-between items-center">
                                    <span class="text-xs font-bold text-gray-300 tracking-wider">1. INPUT ASLI</span>
                                    <i class="fa-regular fa-image text-gray-600"></i>
                                </div>
                                <div class="p-4 h-64 flex justify-center bg-black">
                                    <img id="display-orig" src="" class="h-full object-contain group-hover:scale-105 transition duration-700">
                                </div>
                            </div>

                            <div class="group bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden hover:border-blue-500/50 transition duration-500 shadow-lg">
                                <div class="bg-gray-800/30 px-6 py-3 border-b border-gray-800 flex justify-between items-center">
                                    <span class="text-xs font-bold text-blue-400 tracking-wider">2. PREDIKSI MASKER</span>
                                    <i class="fa-solid fa-robot text-blue-500/50"></i>
                                </div>
                                <div class="p-4 h-64 flex justify-center bg-black">
                                    <img id="display-mask" src="" class="h-full object-contain group-hover:scale-105 transition duration-700">
                                </div>
                            </div>

                            <div class="group bg-gray-900 border border-gray-800 rounded-2xl overflow-hidden hover:border-red-500/50 transition duration-500 shadow-lg relative">
                                <div class="bg-gray-800/30 px-6 py-3 border-b border-gray-800 flex justify-between items-center">
                                    <span class="text-xs font-bold text-red-400 tracking-wider">3. HASIL OVERLAY</span>
                                    <i class="fa-solid fa-layer-group text-red-500/50"></i>
                                </div>
                                <div class="p-4 h-64 flex justify-center bg-black relative">
                                    <img id="display-res" src="" class="h-full object-contain z-10 group-hover:scale-105 transition duration-700">
                                </div>
                            </div>
                        </div>

                        <div class="relative overflow-hidden p-4 md:p-0"> 

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                                
                                <div class="flex flex-col items-center justify-center relative min-h-[300px] bg-gray-800/10 border border-gray-700/30 rounded-2xl p-4">
                                    
                                    <h4 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Komposisi Area Otak</h4>
                                    
                                    <div id="tumor-chart" class="relative z-10"></div> 

                                    <div class="absolute bottom-4 left-4 flex flex-col gap-2 z-20">
                                        <div class="flex items-center gap-2.5">
                                            <span class="w-3 h-3 rounded-full bg-[#ef4444] shadow-[0_0_6px_rgba(239,68,68,0.8)]"></span>
                                            <span class="text-[10px] text-gray-300 font-bold tracking-wide uppercase">Tumor</span>
                                        </div>
                                        <div class="flex items-center gap-2.5">
                                            <span class="w-3 h-3 rounded-full bg-[#3b82f6] shadow-[0_0_6px_rgba(59,130,246,0.8)]"></span>
                                            <span class="text-[10px] text-gray-300 font-bold tracking-wide uppercase">Non-Tumor</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    
                                    <div>
                                        <div class="flex justify-between text-xs mb-2">
                                            <span class="text-gray-400 font-medium">Total Luas Tumor (Area)</span>
                                            <span class="text-white font-bold">
                                                <span id="stat-area-detail">0</span> 
                                                <span class="text-[10px] text-gray-500 font-normal">cm²</span>
                                            </span>
                                        </div>
                                        <div class="w-full bg-gray-800 rounded-full h-3 border border-gray-700 overflow-hidden">
                                            <div id="bar-area" class="bg-gradient-to-r from-yellow-500 to-orange-600 h-full rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(234,179,8,0.5)]" style="width: 0%"></div>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1">Estimasi ukuran fisik tumor (Visual Scale: Max 25cm²).</p>
                                    </div>

                                    <div>
                                        <div class="flex justify-between text-xs mb-2">
                                            <span class="text-gray-400 font-medium">Kepadatan Tumor (Density)</span>
                                            <span class="text-white font-bold"><span id="stat-density">0</span>%</span>
                                        </div>
                                        <div class="w-full bg-gray-800 rounded-full h-3 border border-gray-700 overflow-hidden">
                                            <div id="bar-density" class="bg-gradient-to-r from-blue-500 to-purple-600 h-full rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(59,130,246,0.5)]" style="width: 0%"></div>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1">Persentase area tumor dibandingkan total area otak.</p>
                                    </div>

                                    <div>
                                        <div class="flex justify-between text-xs mb-2">
                                            <span class="text-gray-400 font-medium">Jumlah Lesi (Cluster)</span>
                                            <span class="text-white font-bold"><span id="stat-count">0</span> Spot</span>
                                        </div>
                                        <div class="flex gap-2">
                                            <div id="spot-1" class="h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300"></div>
                                            <div id="spot-2" class="h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300"></div>
                                            <div id="spot-3" class="h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300"></div>
                                            <div id="spot-4" class="h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300"></div>
                                            <div id="spot-5" class="h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300"></div>
                                        </div>
                                        <p class="text-[10px] text-gray-500 mt-1">Indikator visual jumlah titik tumor yang terpisah.</p>
                                    </div>

                                </div>
                            </div>
                        </div>
                        </div>
                </div>
        </div>

    </main>

    <footer class="border-t border-gray-800 bg-gray-950 mt-auto">
        <div class="w-full px-6 md:px-12 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                
                <div class="text-center md:text-left">
                    <h4 class="text-white font-bold text-sm tracking-wide">Visi Komputer</h4>
                    <p class="text-gray-500 text-xs mt-1">Politeknik Negeri Semarang</p>
                </div>
                
                <div class="flex gap-4">
                    <a href="https://github.com/RafaEnricoo" class="w-8 h-8 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center text-gray-400 hover:bg-white hover:text-black transition-all duration-300 shadow-lg hover:shadow-white/20">
                        <i class="fa-brands fa-github text-sm"></i>
                    </a>
                    <a href="https://www.linkedin.com/in/Muhammad_Rafa_Enrico" class="w-8 h-8 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center text-gray-400 hover:bg-blue-600 hover:text-white hover:border-blue-500 transition-all duration-300 shadow-lg hover:shadow-blue-500/30">
                        <i class="fa-brands fa-linkedin text-sm"></i>
                    </a>
                    <a href="mailto:muhammadrafaenrico@gmail.com" class="w-8 h-8 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center text-gray-400 hover:bg-emerald-500 hover:text-white hover:border-emerald-400 transition-all duration-300 shadow-lg hover:shadow-emerald-500/30">
                        <i class="fa-solid fa-envelope text-sm"></i>
                    </a>
                </div>

                <div class="text-gray-600 text-xs text-center md:text-right">
                    <p>Project Assignment &copy; 2025</p>
                    <p class="text-gray-300 font-semibold mt-0.5">Muhammad Rafa Enrico</p>
                </div>

            </div>
        </div>
    </footer>

    <script>
        // --- 1. DEFINISI VARIABLE DOM ---
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-upload');
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const fileNameDisplay = document.getElementById('file-name');
        const loadingBar = document.getElementById('loading-bar'); 
        const resultSection = document.getElementById('result-section');

        // --- 2. FUNGSI HANDLE FILE (PREVIEW SUPPORTS TIFF) ---
        function handleFile(file) {
            if (!file) return;

            // Cek Ekstensi File
            const fileName = file.name.toLowerCase();
            const isTiff = fileName.endsWith('.tif') || fileName.endsWith('.tiff');
            const isStandardImage = file.type.startsWith('image/') || fileName.endsWith('.jpg') || fileName.endsWith('.png') || fileName.endsWith('.jpeg');

            if (isStandardImage || isTiff) {
                
                // A. JIKA FILE ADALAH TIFF (Butuh perlakuan khusus)
                if (isTiff) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const buffer = e.target.result;
                        const ifds = UTIF.decode(buffer);
                        
                        // Ambil halaman pertama dari TIFF
                        UTIF.decodeImage(buffer, ifds[0]);
                        const rgba = UTIF.toRGBA8(ifds[0]); // Konversi ke array piksel RGBA
                        const width = ifds[0].width;
                        const height = ifds[0].height;

                        // Gambar ke Canvas sementara
                        const canvas = document.createElement("canvas");
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext("2d");
                        const imgData = ctx.createImageData(width, height);
                        
                        // Masukkan data piksel ke canvas
                        for (let i = 0; i < rgba.length; i++) {
                            imgData.data[i] = rgba[i];
                        }
                        ctx.putImageData(imgData, 0, 0);

                        // Konversi Canvas ke URL Gambar (PNG) agar bisa masuk tag <img>
                        imagePreview.src = canvas.toDataURL();
                        
                        // Tampilkan UI
                        showPreviewUI();
                    };
                    reader.readAsArrayBuffer(file); // TIFF harus dibaca sebagai ArrayBuffer
                } 
                
                // B. JIKA FILE GAMBAR BIASA (JPG/PNG)
                else {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        showPreviewUI();
                    };
                    reader.readAsDataURL(file);
                }

            } else {
                alert("Format file tidak didukung! Harap upload JPG, PNG, atau TIF.");
            }
        }

        // Fungsi Helper untuk Update UI Preview
        function showPreviewUI() {
            previewContainer.classList.add('opacity-0', 'absolute'); 
            imagePreview.classList.remove('hidden'); 
            
            // Update Text Nama File
            fileNameDisplay.textContent = `File Siap: ${fileInput.files[0].name}`;
            fileNameDisplay.classList.remove('hidden');

            // Hapus error visual jika ada
            dropZone.classList.remove('border-red-500', 'bg-red-500/10');
            dropZone.classList.add('border-blue-500'); 
        }

        // Listener saat file dipilih manual
        fileInput.addEventListener('change', function() { handleFile(this.files[0]); });

        // --- 3. AJAX SUBMIT (ANALISIS TANPA RELOAD) ---
        async function validateAndAnalyze(event) {
            event.preventDefault(); // Mencegah reload halaman standar

            // Validasi: Cek file kosong
            if (fileInput.files.length === 0) {
                alert("⚠️ Harap pilih atau drag file MRI terlebih dahulu!");
                dropZone.classList.add('border-red-500', 'bg-red-500/10');
                dropZone.classList.remove('border-gray-700');
                setTimeout(() => {
                    dropZone.classList.remove('border-red-500', 'bg-red-500/10');
                    dropZone.classList.add('border-gray-700');
                }, 1500);
                return;
            }

            // Tampilkan Loading
            loadingBar.classList.remove('hidden');
            
            // Siapkan Data untuk dikirim
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                // Kirim Request ke Python (/analyze)
                const response = await fetch('/analyze', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    // Jika sukses, update tampilan dengan data baru
                    updateUI(data);
                } else {
                    alert("Error: " + data.error);
                }

            } catch (error) {
                alert("Terjadi kesalahan koneksi: " + error);
            } finally {
                loadingBar.classList.add('hidden'); // Sembunyikan loading selesai
            }
        }
        
        // Variable global untuk chart agar bisa di-destroy/update
        let tumorChart = null;

        function updateUI(data) {
            // 1. Update Gambar (Summary Visual)
            document.getElementById('display-res-hero').src = data.res_url;
            document.getElementById('display-orig').src = data.orig_url;
            document.getElementById('display-mask').src = data.mask_url;
            document.getElementById('display-res').src = data.res_url;

            // 2. Update Teks Judul & Status
            const predText = document.getElementById('display-prediction');
            predText.textContent = data.prediction;
            predText.className = `text-5xl md:text-6xl font-extrabold drop-shadow-lg tracking-tight leading-none ${data.status_color}`;

            document.getElementById('display-count').textContent = data.count;
            document.getElementById('display-area').textContent = data.area;
            
            const statusLabel = document.getElementById('display-status-label');
            statusLabel.textContent = data.status_label;
            statusLabel.className = `text-xl font-bold ${data.status_text_color}`;

            const iconContainer = document.getElementById('icon-container');
            const badge = document.getElementById('tumor-badge');
            
            if (data.prediction === 'No Tumor') {
                iconContainer.innerHTML = '<i class="fa-solid fa-circle-check text-4xl text-green-500/50"></i>';
                if(badge) badge.classList.add('hidden');
            } else {
                iconContainer.innerHTML = `<div class="relative"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-20"></span><i class="fa-solid fa-triangle-exclamation text-4xl text-red-500"></i></div>`;
                if(badge) badge.classList.remove('hidden');
            }

            // --- BAGIAN BARU: UPDATE GRAFIK & PROGRESS BAR ---
            
            // Konversi nilai ke Float
            const densityVal = parseFloat(data.density);
            const areaVal = parseFloat(data.area);

            // A. Update Bar Area (Visual Scale: Max 50cm2)
            document.getElementById('stat-area-detail').textContent = data.area;
            // Rumus:
            const areaPercent = Math.min((areaVal / 25) * 100, 100); 
            document.getElementById('bar-area').style.width = `${areaPercent}%`;

            // B. Update Bar Density
            document.getElementById('stat-density').textContent = data.density;
            document.getElementById('bar-density').style.width = `${Math.min(densityVal, 100)}%`;
            
            // C. Update Bar Count
            document.getElementById('stat-count').textContent = data.count;
            for(let i=1; i<=5; i++) {
                const el = document.getElementById(`spot-${i}`);
                if(i <= data.count) el.className = "h-2 flex-1 bg-red-500 rounded-full shadow-[0_0_5px_rgba(239,68,68,0.8)] transition-all duration-300";
                else el.className = "h-2 flex-1 bg-gray-800 rounded-full transition-all duration-300";
            }

            // D. Render ApexChart (Donut)
            if (tumorChart) tumorChart.destroy(); 

            // Warna Default (Saat tidak ada kursor)
            // Jika ada tumor -> Merah, Jika bersih -> Biru
            const defaultColor = densityVal > 0 ? '#ef4444' : '#3b82f6';
            
            // Definisi warna Slice: [0: Tumor (Merah), 1: Sehat (Biru)]
            const chartColors = ['#ef4444', '#3b82f6'];

            // Hitung nilai sisi sehat dengan pembulatan 2 desimal agar tidak error koma panjang
            const healthyVal = parseFloat((100 - densityVal).toFixed(2));

            const options = {
                // REVISI 1: Gunakan variable healthyVal yang sudah dibulatkan
                series: [densityVal, healthyVal], 
                
                chart: { 
                    type: 'donut', 
                    height: 300, // Ukuran pas
                    background: 'transparent',
                    events: {
                        dataPointMouseEnter: function(event, chartContext, config) {
                            const idx = config.dataPointIndex;
                            const valueLabel = document.querySelector('#tumor-chart .apexcharts-datalabel-value');
                            if(valueLabel) valueLabel.style.fill = chartColors[idx];
                        },
                        dataPointMouseLeave: function(event, chartContext, config) {
                            const valueLabel = document.querySelector('#tumor-chart .apexcharts-datalabel-value');
                            if(valueLabel) valueLabel.style.fill = defaultColor;
                        }
                    }
                },
                labels: ['Tumor', 'Non-Tumor'],
                colors: chartColors, 
                stroke: { show: false },
                dataLabels: { enabled: false },
                
                // REVISI 2: Tambahkan format Tooltip agar rapi saat di-hover
                tooltip: { 
                    theme: 'dark',
                    y: {
                        formatter: function(val) {
                            return val + "%";
                        }
                    }
                },

                plotOptions: {
                    pie: {
                        donut: {
                            size: '60%', // Ukuran ketebalan donat (makin besar makin tipis)
                            labels: {
                                show: true,
                                name: { show: false },
                                value: {
                                    show: true, 
                                    fontSize: '28px', 
                                    fontWeight: 800, 
                                    color: defaultColor, 
                                    // REVISI 3: Pakai toFixed(2) untuk angka tengah
                                    formatter: function (val) { 
                                        return parseFloat(val).toFixed(2) + "%";
                                    }
                                },
                                total: {
                                    show: true, 
                                    label: 'Tumor', 
                                    color: '#9ca3af',
                                    // REVISI 4: Pakai toFixed(2) untuk total label
                                    formatter: function (w) { 
                                        return densityVal.toFixed(2) + "%";
                                    }
                                }
                            }
                        }
                    }
                },
                legend: { show: false }
            };

            tumorChart = new ApexCharts(document.querySelector("#tumor-chart"), options);
            tumorChart.render();

            // Tampilkan Result Section dengan animasi halus
            resultSection.classList.remove('hidden');
            resultSection.style.opacity = '0';
            setTimeout(() => resultSection.style.opacity = '1', 50);
            
            setTimeout(() => {
                resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // --- 5. FUNGSI RESET (TANPA RELOAD) ---
        function resetApp() {
            // Animasi Fade Out
            if (resultSection) {
                resultSection.style.transition = "opacity 0.3s ease-out";
                resultSection.style.opacity = "0";
                
                setTimeout(() => {
                    resultSection.classList.add('hidden');
                    resultSection.style.opacity = '1'; // Reset opacity untuk penggunaan berikutnya
                    
                    // Tutup detail layer jika terbuka
                    const detailSection = document.getElementById('detailed-results');
                    const chevron = document.getElementById('chevron-icon');
                    if(detailSection) detailSection.classList.add('hidden');
                    if(chevron) chevron.style.transform = 'rotate(0deg)';
                }, 300);
            }

            // Reset Form Input HTML
            document.getElementById('upload-form').reset();

            // Reset Tampilan Upload ke Awal
            previewContainer.classList.remove('opacity-0', 'absolute');
            imagePreview.classList.add('hidden');
            imagePreview.src = '#';
            
            fileNameDisplay.classList.add('hidden');
            fileNameDisplay.textContent = '';

            dropZone.classList.remove('border-blue-500', 'border-red-500', 'bg-red-500/10');
            dropZone.classList.add('border-gray-700');

            // Scroll Balik ke Kotak Upload
            document.getElementById('detect').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // --- 6. DRAG & DROP EVENTS ---
        dropZone.addEventListener('dragover', (e) => { 
            e.preventDefault(); 
            dropZone.classList.add('border-blue-500', 'bg-gray-800'); 
            dropZone.classList.remove('border-gray-700', 'border-red-500');
        });
        
        dropZone.addEventListener('dragleave', () => { 
            dropZone.classList.remove('border-blue-500', 'bg-gray-800'); 
            dropZone.classList.add('border-gray-700');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault(); 
            dropZone.classList.remove('border-blue-500', 'bg-gray-800');
            dropZone.classList.add('border-gray-700');
            if (e.dataTransfer.files.length) { 
                fileInput.files = e.dataTransfer.files; 
                handleFile(e.dataTransfer.files[0]); 
            }
        });

        // --- 7. TOGGLE DETAIL LAYER ---
        function toggleDetails() {
            const detailSection = document.getElementById('detailed-results');
            const chevron = document.getElementById('chevron-icon');
            const btnText = document.getElementById('btn-detail').querySelector('span');

            if (detailSection.classList.contains('hidden')) {
                // BUKA
                detailSection.classList.remove('hidden');
                setTimeout(() => { detailSection.classList.remove('opacity-0', 'translate-y-4'); }, 10);
                chevron.style.transform = 'rotate(180deg)';
                btnText.textContent = "Sembunyikan Detail";
                detailSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                // TUTUP
                detailSection.classList.add('opacity-0', 'translate-y-4');
                chevron.style.transform = 'rotate(0deg)';
                btnText.textContent = "Lihat Detail Layer";
                setTimeout(() => { detailSection.classList.add('hidden'); }, 500);
            }
        }

        // --- 8. SCROLL SPY (NAVBAR ACTIVE STATE) - STRICT GUARD ---
        const sections = document.querySelectorAll("#about, #technology, #detect");
        const navLinks = document.querySelectorAll(".nav-link");

        function activeMenu() {
            let current = "";
            const scrollY = window.scrollY;
            const viewportHeight = window.innerHeight; 
            
            // Loop section
            sections.forEach((section) => {
                const sectionTop = section.offsetTop;
                // Nyala jika masuk 1/3 layar
                if (scrollY >= (sectionTop - (viewportHeight / 3))) {
                    current = section.getAttribute("id");
                }
            });

            // HERO GUARD: Matikan menu jika masih di area Hero (600px pertama)
            if (scrollY < 600) {
                current = "";
            }

            // Update CSS Navbar
            navLinks.forEach(link => {
                const line = link.querySelector('.nav-line');
                const linkHref = link.getAttribute("href").substring(1); 
                
                if (linkHref === current && current !== "") {
                    line.classList.remove('w-0');
                    line.classList.add('w-full');
                    link.classList.add('text-white');
                } else {
                    line.classList.remove('w-full');
                    line.classList.add('w-0');
                    link.classList.remove('text-white');
                }
            });
        }

        activeMenu(); // Jalankan saat load
        window.addEventListener("scroll", activeMenu);
    </script>
</body>
</html>